No kind clusters found.
Creating Kind cluster 'karo-test-e2e'...
Creating cluster "karo-test-e2e" ...
 ‚Ä¢ Ensuring node image (kindest/node:v1.34.0) üñº  ...
 ‚úì Ensuring node image (kindest/node:v1.34.0) üñº
 ‚Ä¢ Preparing nodes üì¶   ...
 ‚úì Preparing nodes üì¶ 
 ‚Ä¢ Writing configuration üìú  ...
 ‚úì Writing configuration üìú
 ‚Ä¢ Starting control-plane üïπÔ∏è  ...
 ‚úì Starting control-plane üïπÔ∏è
 ‚Ä¢ Installing CNI üîå  ...
 ‚úì Installing CNI üîå
 ‚Ä¢ Installing StorageClass üíæ  ...
 ‚úì Installing StorageClass üíæ
Set kubectl context to "kind-karo-test-e2e"
You can now use your cluster with:

kubectl cluster-info --context kind-karo-test-e2e

Thanks for using kind! üòä
Downloading sigs.k8s.io/controller-tools/cmd/controller-gen@v0.14.0
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/controller-gen object:headerFile="hack/boilerplate.go.txt" paths="./..."
go fmt ./...
go vet ./...
Setting kubectl context to use kind cluster...
Switched to context "kind-karo-test-e2e".
Installing CRDs...
make[1]: Entering directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
Downloading sigs.k8s.io/controller-tools/cmd/controller-gen@v0.14.0
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases
Downloading sigs.k8s.io/kustomize/kustomize/v5@v5.0.1
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/kustomize build config/crd | kubectl apply -f -
Warning: unrecognized format "int64"
Warning: unrecognized format "int32"
customresourcedefinition.apiextensions.k8s.io/restartrules.karo.jeeatwork.com created
make[1]: Leaving directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
Running e2e tests (controller started within test process)...
=== RUN   TestControllerLogAccess
    controller_logs_test.go:40: Creating test namespace...
    controller_logs_test.go:45: Starting controller manager...
    test_utils.go:183: Controller manager started
    test_utils.go:172: Starting controller manager in goroutine...
    controller_logs_test.go:60: Testing log access...
    controller_logs_test.go:66: Captured 24 log lines
    controller_logs_test.go:36: SUCCESS: Controller log access functionality is working correctly
    test_utils.go:197: Stopping controller manager...
    test_utils.go:179: Controller manager stopped
    test_utils.go:516: Waiting for namespace to be terminated...
    test_utils.go:529: Namespace successfully terminated
--- PASS: TestControllerLogAccess (8.62s)
=== RUN   TestDelayedRestartBasic
    delay_restart_e2e_test.go:591: Creating delay test namespace...
    delay_restart_e2e_test.go:596: Starting controller manager...
    test_utils.go:183: Controller manager started
    test_utils.go:172: Starting controller manager in goroutine...
    delay_restart_e2e_test.go:57: === Testing basic delayed restart (5 seconds) ===
    delay_restart_e2e_test.go:60: Creating test deployment...
    delay_restart_e2e_test.go:70: Creating test ConfigMap...
    delay_restart_e2e_test.go:77: Creating RestartRule with 5 second delay...
    delay_restart_e2e_test.go:104: Waiting for RestartRule to become Active...
    delay_restart_e2e_test.go:113: Updating ConfigMap to trigger delayed restart...
    delay_restart_e2e_test.go:119: Verifying restart doesn't happen immediately...
    delay_restart_e2e_test.go:127: Waiting for delayed restart to occur...
    delay_restart_e2e_test.go:136: SUCCESS: Deployment was restarted after 5 second delay
    delay_restart_e2e_test.go:603: Cleaning up delay test resources...
    test_utils.go:197: Stopping controller manager...
    test_utils.go:179: Controller manager stopped
--- PASS: TestDelayedRestartBasic (29.13s)
=== RUN   TestDelayedRestartMultipleRulesHighestWins
    delay_restart_e2e_test.go:591: Creating delay test namespace...
    delay_restart_e2e_test.go:593: Failed to create namespace: Namespace "karo-delay-e2e-test-TestDelayedRestartMultipleRulesHighestWins-20251001-104311-000" is invalid: [metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMultipleRulesHighestWins-20251001-104311-000": must be no more than 63 characters, metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMultipleRulesHighestWins-20251001-104311-000": a lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?'), metadata.labels: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMultipleRulesHighestWins-20251001-104311-000": must be no more than 63 characters]
--- FAIL: TestDelayedRestartMultipleRulesHighestWins (0.00s)
=== RUN   TestDelayedRestartMixedDelayAndNoDelay
    delay_restart_e2e_test.go:591: Creating delay test namespace...
    delay_restart_e2e_test.go:593: Failed to create namespace: Namespace "karo-delay-e2e-test-TestDelayedRestartMixedDelayAndNoDelay-20251001-104311-000" is invalid: [metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMixedDelayAndNoDelay-20251001-104311-000": must be no more than 63 characters, metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMixedDelayAndNoDelay-20251001-104311-000": a lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?'), metadata.labels: Invalid value: "karo-delay-e2e-test-TestDelayedRestartMixedDelayAndNoDelay-20251001-104311-000": must be no more than 63 characters]
--- FAIL: TestDelayedRestartMixedDelayAndNoDelay (0.00s)
=== RUN   TestDelayedRestartAlreadyDelayedTarget
    delay_restart_e2e_test.go:591: Creating delay test namespace...
    delay_restart_e2e_test.go:593: Failed to create namespace: Namespace "karo-delay-e2e-test-TestDelayedRestartAlreadyDelayedTarget-20251001-104311-000" is invalid: [metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartAlreadyDelayedTarget-20251001-104311-000": must be no more than 63 characters, metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartAlreadyDelayedTarget-20251001-104311-000": a lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?'), metadata.labels: Invalid value: "karo-delay-e2e-test-TestDelayedRestartAlreadyDelayedTarget-20251001-104311-000": must be no more than 63 characters]
--- FAIL: TestDelayedRestartAlreadyDelayedTarget (0.01s)
=== RUN   TestDelayedRestartStatefulSet
    delay_restart_e2e_test.go:591: Creating delay test namespace...
    delay_restart_e2e_test.go:593: Failed to create namespace: Namespace "karo-delay-e2e-test-TestDelayedRestartStatefulSet-20251001-104311-000" is invalid: [metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartStatefulSet-20251001-104311-000": must be no more than 63 characters, metadata.name: Invalid value: "karo-delay-e2e-test-TestDelayedRestartStatefulSet-20251001-104311-000": a lowercase RFC 1123 label must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc', regex used for validation is '[a-z0-9]([-a-z0-9]*[a-z0-9])?'), metadata.labels: Invalid value: "karo-delay-e2e-test-TestDelayedRestartStatefulSet-20251001-104311-000": must be no more than 63 characters]
--- FAIL: TestDelayedRestartStatefulSet (0.01s)
=== RUN   TestRestartRuleE2E
    restartrule_e2e_test.go:74: Creating test namespace...
    restartrule_e2e_test.go:79: Starting controller manager...
    test_utils.go:183: Controller manager started
    test_utils.go:172: Starting controller manager in goroutine...
    restartrule_e2e_test.go:84: Creating nginx ConfigMap...
    restartrule_e2e_test.go:90: Creating nginx Secret...
    restartrule_e2e_test.go:96: Creating nginx Deployment...
    restartrule_e2e_test.go:102: Waiting for nginx Deployment to be ready...
    restartrule_e2e_test.go:109: === Testing ConfigMap restart functionality ===
    restartrule_e2e_test.go:111: Creating RestartRule for ConfigMap...
    restartrule_e2e_test.go:117: Waiting for RestartRule to become Active...
    restartrule_e2e_test.go:122: Updating ConfigMap to trigger restart...
    restartrule_e2e_test.go:216: Checking if deployment was rolled after ConfigMap update...
    restartrule_e2e_test.go:239: Restart annotation not found after ConfigMap update, current annotations: map[]
    restartrule_e2e_test.go:230: Found restart annotation after ConfigMap update: karo.jeeatwork.com/restartedAt = 2025-10-01T10:43:33+02:00
    restartrule_e2e_test.go:130: Checking that restart event was recorded in RestartRule status...
    restartrule_e2e_test.go:135: SUCCESS: Deployment was successfully rolled after ConfigMap update and event was recorded
    restartrule_e2e_test.go:141: === Testing Secret restart functionality ===
    restartrule_e2e_test.go:143: Creating RestartRule for Secret...
    restartrule_e2e_test.go:149: Waiting for Secret RestartRule to become Active...
    restartrule_e2e_test.go:154: Updating Secret to trigger restart...
    restartrule_e2e_test.go:216: Checking if deployment was rolled after Secret update...
    restartrule_e2e_test.go:235: Restart annotation exists but hasn't changed since last update: 2025-10-01T10:43:33+02:00
    restartrule_e2e_test.go:239: Restart annotation not found after Secret update, current annotations: map[karo.jeeatwork.com/restartedAt:2025-10-01T10:43:33+02:00]
    restartrule_e2e_test.go:230: Found restart annotation after Secret update: karo.jeeatwork.com/restartedAt = 2025-10-01T10:43:53+02:00
    restartrule_e2e_test.go:162: Checking that restart event was recorded in Secret RestartRule status...
    restartrule_e2e_test.go:168: SUCCESS: Deployment was successfully rolled after Secret update and event was recorded
    restartrule_e2e_test.go:257: === Test completed successfully ===
    restartrule_e2e_test.go:258: ConfigMap restart time: 2025-10-01T10:43:33+02:00
    restartrule_e2e_test.go:259: Secret restart time: 2025-10-01T10:43:53+02:00
    restartrule_e2e_test.go:260: Both ConfigMap and Secret updates successfully triggered deployment restarts
    test_utils.go:444: Cleaning up test resources...
    test_utils.go:197: Stopping controller manager...
    test_utils.go:179: Controller manager stopped
    test_utils.go:516: Waiting for namespace to be terminated...
    test_utils.go:529: Namespace successfully terminated
--- PASS: TestRestartRuleE2E (60.85s)
=== RUN   TestRestartRuleRegexE2E
    restartrule_e2e_test.go:278: Creating test namespace for regex tests...
    restartrule_e2e_test.go:283: Starting controller manager...
    test_utils.go:183: Controller manager started
    test_utils.go:172: Starting controller manager in goroutine...
    restartrule_e2e_test.go:294: Creating multiple ConfigMaps with different names...
    restartrule_e2e_test.go:309: Creating multiple Secrets with different names...
    restartrule_e2e_test.go:324: Creating test deployments...
    restartrule_e2e_test.go:342: === Testing ConfigMap regex pattern matching ===
    restartrule_e2e_test.go:344: Creating RestartRule with regex pattern for ConfigMaps...
    restartrule_e2e_test.go:350: Waiting for ConfigMap regex RestartRule to become Active...
    restartrule_e2e_test.go:356: Updating ConfigMap that matches regex pattern...
    restartrule_e2e_test.go:488: Checking if deployment nginx-frontend was restarted after ConfigMap regex update...
    restartrule_e2e_test.go:500: Found restart annotation after ConfigMap regex update: karo.jeeatwork.com/restartedAt = 2025-10-01T10:44:44+02:00
    restartrule_e2e_test.go:365: Checking that restart event was recorded in regex ConfigMap RestartRule status...
    restartrule_e2e_test.go:371: SUCCESS: Deployment was restarted after ConfigMap with matching regex was updated and event was recorded
    restartrule_e2e_test.go:375: === Testing Secret regex pattern matching ===
    restartrule_e2e_test.go:377: Creating RestartRule with regex pattern for Secrets...
    restartrule_e2e_test.go:383: Waiting for Secret regex RestartRule to become Active...
    restartrule_e2e_test.go:388: Updating Secret that matches regex pattern...
    restartrule_e2e_test.go:488: Checking if deployment nginx-frontend was restarted after Secret regex update...
    restartrule_e2e_test.go:500: Found restart annotation after Secret regex update: karo.jeeatwork.com/restartedAt = 2025-10-01T10:44:44+02:00
    restartrule_e2e_test.go:396: Checking that restart event was recorded in regex Secret RestartRule status...
    restartrule_e2e_test.go:402: SUCCESS: Deployment was restarted after Secret with matching regex was updated and event was recorded
    restartrule_e2e_test.go:406: === Testing that non-matching resources are not affected ===
    restartrule_e2e_test.go:409: Creating RestartRule for non-matching test...
    restartrule_e2e_test.go:437: Waiting for non-matching RestartRule to become Active...
    restartrule_e2e_test.go:454: Updating ConfigMap that does NOT match regex pattern...
    restartrule_e2e_test.go:479: SUCCESS: Deployment was NOT restarted after updating non-matching ConfigMap
    restartrule_e2e_test.go:274: === Regex E2E tests completed successfully ===
    restartrule_e2e_test.go:540: Cleaning up regex test resources...
    test_utils.go:197: Stopping controller manager...
    test_utils.go:179: Controller manager stopped
--- PASS: TestRestartRuleRegexE2E (83.44s)
FAIL
FAIL	karo.jeeatwork.com/test/e2e	182.105s
FAIL
Cleaning up CRDs...
make[1]: Entering directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
Downloading sigs.k8s.io/controller-tools/cmd/controller-gen@v0.14.0
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/controller-gen rbac:roleName=manager-role crd webhook paths="./..." output:crd:artifacts:config=config/crd/bases
Downloading sigs.k8s.io/kustomize/kustomize/v5@v5.0.1
/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45/bin/kustomize build config/crd | kubectl delete --ignore-not-found=false -f -
customresourcedefinition.apiextensions.k8s.io "restartrules.karo.jeeatwork.com" deleted
make[1]: Leaving directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
make[1]: Entering directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
Deleting cluster "karo-test-e2e" ...
Deleted nodes: ["karo-test-e2e-control-plane"]
make[1]: Leaving directory '/home/reuhl/git/github/karo_delay_restart_claude_with_debugger_agent_and_sonnet45'
make: *** [Makefile:186: test-e2e] Error 1
